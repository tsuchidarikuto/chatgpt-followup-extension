# ChatGPT フォローアップ質問 Chrome拡張機能

## 詳細ロードマップ

### 1. プロジェクトセットアップ
- Chrome拡張機能の基本構造を作成
  - プロジェクトフォルダを作成: `chatgpt-followup-extension`
  - 必要なサブフォルダを作成: `popup`, `scripts`, `images`
- `manifest.json`ファイルを設定
  - 拡張機能の名前、説明、バージョンを記述
  - `permissions` フィールドに必要な権限を追加: `"activeTab"`, `"storage"`, `"https://chatgpt.com/*"`
  - `background`, `content_scripts`, `action` フィールドを設定
- アイコンの作成と追加
  - 16x16, 48x48, 128x128 サイズのアイコンを作成
  - `images` フォルダに保存し、`manifest.json` に記述

### 2. ポップアップUIの基本実装
- HTML構造の作成 (`popup.html`)
  - 基本的なHTML5ボイラープレートを作成
  - ChatGPT応答表示用の `<div>` 要素を追加
  - フォローアップ質問入力用の `<textarea>` を追加
  - 送信ボタンを追加
- CSSスタイリング (`popup.css`)
  - ポップアップウィンドウの基本スタイルを設定（幅、高さ、背景色など）
  - ChatGPT応答表示エリアのスタイリング（スクロール可能に）
  - 入力フィールドと送信ボタンのスタイリング
- 基本的なJavaScript機能の実装 (`popup.js`)
  - DOMロード時の初期化関数を作成
  - 送信ボタンのクリックイベントリスナーを追加

### 3. ChatGPT応答の取得
- Content scriptの作成 (`content.js`)
  - ChatGPTの応答を含む要素のセレクタを特定
  - `MutationObserver` を使用して動的に追加される応答を監視
  - 最新の応答をキャプチャする関数を実装
- Background scriptの作成 (`background.js`)
  - Content scriptからメッセージを受け取る機能を実装
  - 受け取ったデータを `chrome.storage` に保存
- ポップアップスクリプトの拡張 (`popup.js`)
  - ポップアップ開始時に `chrome.storage` から最新の応答を取得
  - 取得したデータをポップアップUIに表示する機能を実装

### 4. ユーザー入力処理
- ポップアップUIの拡張
  - フォローアップ質問入力欄にプレースホルダーテキストを追加
  - 入力文字数制限と文字数カウンター表示機能を実装
- 入力バリデーション機能の実装 (`popup.js`)
  - 空の入力を防ぐチェック機能を追加
  - 入力文字数の制限（例：500文字）を実装
- 入力データの前処理
  - 入力テキストのトリミングと特殊文字のエスケープ処理を実装

### 5. ChatGPT APIとの連携
- APIキー管理機能の実装
  - ユーザーがAPIキーを入力・保存できる設定ページを作成
  - APIキーを安全に `chrome.storage` に保存する機能を実装
- API通信機能の実装 (`popup.js`)
  - `fetch` APIを使用してChatGPT APIにリクエストを送信する関数を作成
  - レスポンスを受け取り、解析する機能を実装
  - フォローアップの過程で直近の3ラリーを保持し、APIへの入力に含める処理を追加
- エラーハンドリング
  - API通信エラーを捕捉し、ユーザーにフィードバックする機能を実装
  - レートリミットやクォータ超過の処理を実装

### 6. UI/UXの改善
- ローディング表示の実装
  - API通信中のローディングスピナーを追加
- エラーメッセージの表示
  - エラー発生時のユーザーフレンドリーなメッセージ表示機能を実装
- レスポンシブデザインの適用
  - 異なるウィンドウサイズに対応するCSSメディアクエリを実装
- ChatGPT風のUIデザインを適用

### 7. テストとデバッグ
- 単体テストの実施
  - 各関数の動作を確認するJestテストを作成
- 統合テスト
  - 拡張機能全体の動作を確認するE2Eテストを実装
- クロスブラウザテスト
  - Chrome, Firefox, Edgeなど複数のブラウザで動作確認
- パフォーマンステスト
  - メモリ使用量と実行速度のプロファイリングを実施

### 8. セキュリティ強化
- コンテンツセキュリティポリシー（CSP）の実装
  - `manifest.json` にCSPを追加し、XSSなどの攻撃を防止
- APIキーの暗号化
  - 保存されたAPIキーを暗号化する機能を実装
- HTTPS通信の強制
  - すべての通信がHTTPS経由で行われることを確認

### 9. ドキュメント作成と最終調整
- README.mdの作成
  - プロジェクトの概要、インストール手順、使用方法を記述
- コードコメントの追加
  - 各ファイルと主要な関数にJSDocコメントを追加
- マニフェストの最終確認
  - すべての必要な権限と設定が正しく記述されているか確認
- パッケージング
  - 拡張機能をCRXファイルにパッケージング
- トークのリセット機能の追加

## 完成後のディレクトリ構造```
chatgpt-followup-extension/
│
├── manifest.json
├── popup/
│   ├── popup.html
│   ├── popup.css
│   ├── popup.js
│   └──settings.html
├── scripts/
│   ├── content.js
│   └── background.js
├── images/
│   ├── icon-16.png
│   ├── icon-48.png
│   └── icon-128.png
├── tests/
│   ├── popup.test.js
│   ├── content.test.js
│   └── api.test.js
├── README.md
└── LICENSE
```

## ファイルの説明

1. `manifest.json`: 拡張機能の設定ファイル。バージョン、権限、アイコン、バックグラウンドスクリプトなどを定義。
2. `popup/`: ポップアップUI関連のファイル
   - `popup.html`: ポップアップのHTML構造。応答表示エリア、入力フィールド、送信ボタンを含む。
   - `popup.css`: ポップアップのスタイル。レスポンシブデザインとダークモード対応を含む。
   - `popup.js`: ポップアップの動作を制御するJavaScript。API通信、UI更新、エラーハンドリングを担当。
3. `scripts/`: 拡張機能の主要なスクリプト
   - `content.js`: ウェブページ上でChatGPTの応答を取得するスクリプト。MutationObserverを使用。
   - `background.js`: バックグラウンドで動作し、他のコンポーネントを管理するスクリプト。メッセージングを処理。
4. `images/`: 拡張機能のアイコン（複数サイズ）
5. `tests/`: 単体テストと統合テストのファイル
6. `README.md`: 拡張機能の説明、インストール方法、使用方法、開発者向け情報を記載
7. `LICENSE`: オープンソースライセンス情報

## 必要な権限とその理由

1. `"activeTab"`: 現在アクティブなタブにアクセスするために必要。ChatGPTの応答を取得する際に使用。
2. `"storage"`: 拡張機能のデータ（設定、APIキーなど）を保存するために使用。
3. `"https://chatgpt.com/*"`: ChatGPTのウェブサイトにアクセスするために必要。コンテンツスクリプトの実行に使用。
4. `"https://api.openai.com/*"`: ChatGPT APIと通信するために必要。フォローアップ質問の送信に使用。

## インストール手順

1. Githubからプロジェクトをクローンまたはダウンロードする
2. Chromeブラウザで `chrome://extensions` を開く
3. 右上の「デベロッパーモード」をオンにする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. ダウンロードしたプロジェクトのフォルダを選択

## 使用方法

1. ChatGPTのウェブサイト（https://chatgpt.com/）を開く
2. ChatGPTとの対話後、Chrome拡張機能のアイコンをクリック
3. ポップアップウィンドウが開き、最新のChatGPT応答が表示される
4. フォローアップ質問を入力欄に記入
5. 「送信」ボタンをクリックして質問を送信
6. ChatGPTからの新しい応答がポップアップに表示される

注意：
- この拡張機能はChatGPTのウェブサイトでのみ動作します。
- ChatGPT APIの利用には別途OpenAIアカウントとAPIキーが必要です。
- APIキーは拡張機能の設定ページで入力・保存する必要があります。
- 個人情報や機密情報をフォローアップ質問に含めないよう注意してください。

